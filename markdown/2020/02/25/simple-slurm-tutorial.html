<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Simple SLURM Tutorial | Catch Me Coding</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Simple SLURM Tutorial" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A brief introduction to submitting jobs with SLURM for those with basic experience on using an HPC cluster." />
<meta property="og:description" content="A brief introduction to submitting jobs with SLURM for those with basic experience on using an HPC cluster." />
<link rel="canonical" href="https://nicole-brewer.com/catch-me-coding/markdown/2020/02/25/simple-slurm-tutorial.html" />
<meta property="og:url" content="https://nicole-brewer.com/catch-me-coding/markdown/2020/02/25/simple-slurm-tutorial.html" />
<meta property="og:site_name" content="Catch Me Coding" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-25T00:00:00-06:00" />
<script type="application/ld+json">
{"url":"https://nicole-brewer.com/catch-me-coding/markdown/2020/02/25/simple-slurm-tutorial.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://nicole-brewer.com/catch-me-coding/markdown/2020/02/25/simple-slurm-tutorial.html"},"headline":"Simple SLURM Tutorial","dateModified":"2020-02-25T00:00:00-06:00","datePublished":"2020-02-25T00:00:00-06:00","description":"A brief introduction to submitting jobs with SLURM for those with basic experience on using an HPC cluster.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/catch-me-coding/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nicole-brewer.com/catch-me-coding/feed.xml" title="Catch Me Coding" /><link rel="shortcut icon" type="image/x-icon" href="/catch-me-coding/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/catch-me-coding/">Catch Me Coding</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/catch-me-coding/search/">Search</a><a class="page-link" href="/catch-me-coding/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Simple SLURM Tutorial</h1><p class="page-description">A brief introduction to submitting jobs with SLURM for those with basic experience on using an HPC cluster.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-02-25T00:00:00-06:00" itemprop="datePublished">
        Feb 25, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/catch-me-coding/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#submitting-jobs-with-slurm">Submitting Jobs with SLURM</a>
<ul>
<li class="toc-entry toc-h3"><a href="#example">Example</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#performance-tuning">Performance Tuning</a>
<ul>
<li class="toc-entry toc-h3"><a href="#terminology">Terminology</a></li>
</ul>
</li>
</ul><h2 id="submitting-jobs-with-slurm">
<a class="anchor" href="#submitting-jobs-with-slurm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Submitting Jobs with SLURM</h2>

<p><strong>srun</strong> is used to submit a job for execution or initiate job steps in real time. srun
has a wide variety of options to specify resource requirements</p>

<h3 id="example">
<a class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h3>

<p>The command <code class="language-plaintext highlighter-rouge">hostname</code> ouputs the hostname and domain of the system it is run on in the following format: <code class="language-plaintext highlighter-rouge">hostname.domain</code>.</p>

<p>Try it for yourself:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">hostname</span>
</code></pre></div></div>

<p>Now we can try submitting a SLURM job that can run this command on our available resources in various ways.</p>

<p>First, execute /bin/hostname in six tasks with the <em>-n6</em> option:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-n6</span> <span class="nt">-l</span> <span class="nb">hostname</span> 
</code></pre></div></div>

<p><em>Note:  the <code class="language-plaintext highlighter-rouge">-l</code> option prepends the lines of output with the task number</em></p>

<p>Next, execute <code class="language-plaintext highlighter-rouge">/bin/hostname</code> on three separate nodes with the <em>-N3</em> option:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-N3</span> <span class="nt">-l</span> <span class="nb">hostname</span> 
</code></pre></div></div>

<p>Now try both options together and notice that the default behavior is to divy up the tasks equally among the nodes.</p>

<p>These are just two of the <em>many</em> different ways to specify resource requirements including: minimum
and maximum node count, processor count, and specific nodes to use or not use. We will learn more about these options as we go along, but a complete list can be found <a href="https://slurm.schedmd.com/srun.html">here</a>.</p>

<p>Now we aren’t on this cluster all by ourselves, so typically we want to submit a job or a series of jobs to the queue to wait it’s turn in line to be executed. <strong>sbatch</strong> is used to submit a job script for later execution. The script will typically contain one or more <strong>srun</strong> commands to launch parallel tasks.</p>

<p>For example, we can submit our last exaple job to the queue with the following script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#SBATCH -J first_example  # Job Name</span>
<span class="c">#SBATCH --time=00:00:30   # Walltime</span>
<span class="c">#SBATCH -o output.txt     # The destination file for stdout</span>
<span class="c">#SBATCH -e error.txt      # The destination file for stderr</span>

srun <span class="nb">hostname
</span>srun <span class="nb">echo</span> <span class="s2">"whatever"</span>
</code></pre></div></div>

<p>This naming schema for output and errors isn’t always ideal, because subsequent submission of this script will overwrite these files. To prevent this, we can use <strong>replacement symbols</strong> to customize the filename patterns. Here are some common ones:</p>

<p><strong>%j</strong> - jobid of the running job.</p>

<p><strong>%n</strong> - Node identifier relative to current job (e.g. “0” is the first node of the running job) This will create a separate IO file per node.</p>

<p><strong>%t</strong> -  task identifier (rank) relative to current job. This will create a separate IO file per task.</p>

<p><strong>%u</strong> - User name.</p>

<p><strong>%x</strong> - Job name.</p>

<p>For example we can change the output and error files to include the jobID unique to each submission.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH -o jobID_%j.o     # The destination file for stdout</span>
<span class="c">#SBATCH -e jobID_%j.e     # The destination file for stderr</span>
</code></pre></div></div>

<p>This way we can remove these files relating to one job in particular very easily. Say the jobID of our last job was 292. We can easily remove the files for this run (but not others) by calling:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">rm </span>jobID_292<span class="k">*</span>
</code></pre></div></div>

<p>Or if we want to list the files in numeric order we can use the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> | <span class="nb">sort</span> <span class="nt">-n</span> <span class="nt">-t</span> _ <span class="nt">-k</span> 2
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">sort</code> command has lot of options that makes manipulating token separated file schemas very easily. The <code class="language-plaintext highlighter-rouge">-n</code> flag indicates the sort should be strictly numeric. The <code class="language-plaintext highlighter-rouge">-t _</code> option specifies that sections are separated by underscores, and the <code class="language-plaintext highlighter-rouge">-k 2</code> option indicates that the second “chunk” in between the underscores is the one we want to sort by.</p>

<p>If you are unfamiliar with the pipe symbol (<code class="language-plaintext highlighter-rouge">|</code>), refer to <a href="https://ryanstutorials.net/linuxtutorial/piping.php">this</a> tutorial.</p>

<h2 id="performance-tuning">
<a class="anchor" href="#performance-tuning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance Tuning</h2>

<p>In this section, we will learn about how our cluster architecture influences our resource requirements and runtime performance.</p>

<h3 id="terminology">
<a class="anchor" href="#terminology" aria-hidden="true"><span class="octicon octicon-link"></span></a>Terminology</h3>

<ul>
  <li>
    <p>A <strong>node</strong> contains one or more sockets. 4</p>
  </li>
  <li>
    <p>A <strong>socket</strong> is a receptacle on the motherboard for exactly one processor. 2</p>
  </li>
  <li>
    <p>A <strong>processor</strong> contains one or more (CPU) cores. 20</p>
  </li>
  <li>
    <p>For our purposes, a one <strong>task</strong> is usually assigned to each CPU. (If not the <code class="language-plaintext highlighter-rouge">-c</code> option can be used to specify cores per task.</p>
  </li>
</ul>

<p><img src="https://slurm.schedmd.com/mc_support.gif" alt="Figure: Definitions of Socket, Core, &amp; Thread"></p>

<p>We want to know about Haynes specifically. SLURM has the following command that provides us with useful information about the hardware on our nodes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>scontrol show node
</code></pre></div></div>

<p>First, you will notice that we have five nodes. Next, take note of <code class="language-plaintext highlighter-rouge">CoresPerSocket, Sockets, Boards</code>and <code class="language-plaintext highlighter-rouge">ThreadsPerCore</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CoresPerSocket</span><span class="o">=</span>20
<span class="nv">Sockets</span><span class="o">=</span>2
<span class="nv">Boards</span><span class="o">=</span>1
<span class="nv">ThreadsPerCore</span><span class="o">=</span>1
</code></pre></div></div>

<p>We can verify that <code class="language-plaintext highlighter-rouge">cpu=40</code> by working out the fractions, $\frac{1 \text{ motherboard}}{\text{Node}}<em>\frac{2 \text{ sockets}}{\text{motherboard}}</em>\frac{ 20\text{ cores}}{\text{socket}}= \frac{40 \text{ cores}}{\text{node}}$ .</p>

<p>***Running</p>

<p>tpv33_receivers.dat ‘tpv33_initial_stress.yaml’ tpv33_faultreceivers.dat’ ‘output/data’</p>

<hr>

<p><strong>%A</strong> - Job array’s master job allocation number.</p>

<p><strong>%a</strong> - Job array ID (index) number.</p>

<p><strong>%J</strong> - jobid.stepid of the running job. (e.g. “128.0”)</p>

<p><strong>%N</strong> - short hostname. This will create a separate IO file per node.</p>

<p><strong>%s</strong> - stepid of the running job.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#SBATCH -J array_job</span>
<span class="c">#SBATCH -o jobID_%A_taskID_%a.out</span>
<span class="c">#SBATCH -e jobID_%A_taskID_%a.err</span>
<span class="c">#SBATCH -t 00:05:00</span>
<span class="c">#SBATCH --array=1-20</span>
<span class="c">#SBATCH -n 1</span>

<span class="nb">echo</span> <span class="s2">"SLURM_ARRAY_TASK_ID is </span><span class="nv">$SLURM_ARRAY_TASK_ID</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> result_<span class="nv">$SLURM_ARRAY_JOB_ID</span>.out
<span class="nb">echo</span> <span class="s2">"Waiting </span><span class="nv">$SLURM_ARRAY_TASK_ID</span><span class="s2"> seconds..."</span>
<span class="nb">echo</span> <span class="s2">"All done!"</span>
</code></pre></div></div>


  </div><a class="u-url" href="/catch-me-coding/markdown/2020/02/25/simple-slurm-tutorial.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/catch-me-coding/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/catch-me-coding/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/catch-me-coding/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Nicole Brewer&#39;s Tech Blog</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/nicole-brewer" title="nicole-brewer"><svg class="svg-icon grey"><use xlink:href="/catch-me-coding/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/catch_me_coding" title="catch_me_coding"><svg class="svg-icon grey"><use xlink:href="/catch-me-coding/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
